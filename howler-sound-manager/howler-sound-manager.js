var gdjs;(function(_){const f=new _.Logger("Audio manager"),p={preload:!0,onplayerror:(d,e)=>f.error("Can't play an audio file: "+e),onloaderror:(d,e)=>f.error("Error while loading an audio file: "+e)},w=d=>d>1?1:d<0?0:d;class y{constructor(e,t,s,o){this._id=null;this._oncePlay=[];this._onPlay=[];this._howl=e,this._volume=w(t),this._loop=s,this._rate=o}isLoaded(){return this._howl.state()==="loaded"}play(){if(this.isLoaded()){const e=this._howl.play(this._id===null?"__default":this._id);this._id=e,this._howl.volume(this._volume,e),this._howl.loop(this._loop,e),this._howl.rate(_.HowlerSoundManager.clampRate(this._rate),e),this._onPlay.forEach(t=>{this.on("play",t),t(e)}),this._oncePlay.forEach(t=>t(e)),this._onPlay=[],this._oncePlay=[]}else this._howl.once("load",()=>this.play());return this}pause(){return this._id!==null&&this._howl.pause(this._id),this}stop(){return this._id!==null&&this._howl.stop(this._id),this}playing(){return(this._id!==null?this._howl.playing(this._id):!0)||!this.isLoaded()}paused(){return!this.playing()}stopped(){return this.paused()&&this.getSeek()===0}getRate(){return this._rate}setRate(e){return this._rate=e,this._id!==null&&(e=_.HowlerSoundManager.clampRate(e),this._howl.rate(e,this._id)),this}getLoop(){return this._loop}setLoop(e){return this._loop=e,this._id!==null&&this._howl.loop(e,this._id),this}getVolume(){return this._volume}setVolume(e){return this._volume=w(e),this._id!==null&&this._howl.volume(this._volume,this._id),this}getMute(){return this._id===null?!1:this._howl.mute(this._id)}setMute(e){return this._id!==null&&this._howl.mute(e,this._id),this}getSeek(){return this._id===null?0:this._howl.seek(this._id)}setSeek(e){return this._id!==null&&this._howl.seek(e,this._id),this}getSpatialPosition(e){return this._id===null?0:this._howl.pos(this._id)[e==="x"?0:e==="y"?1:2]}setSpatialPosition(e,t,s){return this._id!==null&&this._howl.pos(e,t,s,this._id),this}fade(e,t,s){return this._id!==null&&this._howl.fade(e,t,s,this._id),this}on(e,t){return e==="play"?this._id===null?this._onPlay.push(t):this._howl.on(e,t,this._id):this._id===null?this.once("play",()=>this.on(e,t)):this._howl.on(e,t,this._id),this}once(e,t){return e==="play"?this._id===null?this._oncePlay.push(t):this.playing()?t(this._id):this._howl.once(e,t,this._id):this._id===null?this.once("play",()=>this.once(e,t)):this._howl.once(e,t,this._id),this}off(e,t){return this._id!==null&&this._howl.off(e,t,this._id),this}}_.HowlerSound=y;class g{constructor(e){this._loadedMusics={};this._loadedSounds={};this._availableResources={};this._globalVolume=100;this._sounds={};this._musics={};this._freeSounds=[];this._freeMusics=[];this._pausedSounds=[];this._paused=!1;this._resources=e;const t=this;document.addEventListener("deviceready",function(){document.addEventListener("pause",function(){const s=t._freeSounds.concat(t._freeMusics);for(let o in t._sounds)t._sounds.hasOwnProperty(o)&&s.push(t._sounds[o]);for(let o in t._musics)t._musics.hasOwnProperty(o)&&s.push(t._musics[o]);for(let o=0;o<s.length;o++){const i=s[o];!i.paused()&&!i.stopped()&&(i.pause(),t._pausedSounds.push(i))}t._paused=!0},!1),document.addEventListener("resume",function(){for(let s=0;s<t._pausedSounds.length;s++){const o=t._pausedSounds[s];o.stopped()||o.play()}t._pausedSounds.length=0,t._paused=!1},!1)})}setResources(e){this._resources=e}static clampRate(e){return e>4?4:e<.5?.5:e}_getFileFromSoundName(e){return this._availableResources.hasOwnProperty(e)&&this._availableResources[e].file?this._availableResources[e].file:e}_storeSoundInArray(e,t){for(let s=0,o=e.length;s<o;++s)if(e[s]!==null&&e[s].stopped())return e[s]=t,t;return e.push(t),t}createHowlerSound(e,t,s,o,i){const l=this._getFileFromSoundName(e),n=t?this._loadedMusics:this._loadedSounds;return n.hasOwnProperty(l)||(n[l]=new Howl(Object.assign({src:[l],html5:t,volume:0},p))),new _.HowlerSound(n[l],s,o,i)}loadAudio(e,t){const s=this._getFileFromSoundName(e),o=t?this._loadedMusics:this._loadedSounds;o.hasOwnProperty(s)||(o[s]=new Howl(Object.assign({src:[s],html5:t,volume:0},p)))}unloadAudio(e,t){const s=this._getFileFromSoundName(e),o=t?this._loadedMusics:this._loadedSounds;if(!o[s])return;const i=o[s];function l(n){for(let h in n)n[h]&&n[h]._howl===i&&(n[h].stop(),delete n[h])}l(this._freeMusics),l(this._freeSounds),l(Object.values(this._musics)),l(Object.values(this._sounds)),l(this._pausedSounds),o[s].unload(),delete o[s]}unloadAll(){Howler.unload(),this._freeSounds.length=0,this._freeMusics.length=0,this._sounds={},this._musics={},this._pausedSounds.length=0,this._loadedMusics={},this._loadedSounds={}}playSound(e,t,s,o){const i=this.createHowlerSound(e,!1,s/100,t,o);this._storeSoundInArray(this._freeSounds,i),i.once("play",()=>{this._paused&&(i.pause(),this._pausedSounds.push(i))}),i.play()}playSoundOnChannel(e,t,s,o,i){this._sounds[t]&&this._sounds[t].stop();const l=this.createHowlerSound(e,!1,o/100,s,i);this._sounds[t]=l,l.once("play",()=>{this._paused&&(l.pause(),this._pausedSounds.push(l))}),l.play()}getSoundOnChannel(e){return this._sounds[e]||null}playMusic(e,t,s,o){const i=this.createHowlerSound(e,!0,s/100,t,o);this._storeSoundInArray(this._freeMusics,i),i.once("play",()=>{this._paused&&(i.pause(),this._pausedSounds.push(i))}),i.play()}playMusicOnChannel(e,t,s,o,i){this._musics[t]&&this._musics[t].stop();const l=this.createHowlerSound(e,!0,o/100,s,i);this._musics[t]=l,l.once("play",()=>{this._paused&&(l.pause(),this._pausedSounds.push(l))}),l.play()}getMusicOnChannel(e){return this._musics[e]||null}setGlobalVolume(e){this._globalVolume=e,this._globalVolume>100&&(this._globalVolume=100),this._globalVolume<0&&(this._globalVolume=0),Howler.volume(this._globalVolume/100)}getGlobalVolume(){return this._globalVolume}clearAll(){Howler.stop(),this._freeSounds.length=0,this._freeMusics.length=0,this._sounds={},this._musics={},this._pausedSounds.length=0}preloadAudio(e,t,s){s=s||this._resources;const o={};for(let a=0,u=s.length;a<u;++a){let r=s[a];if(r.file&&r.kind==="audio"){if(this._availableResources[r.name])continue;this._availableResources[r.name]=r,o[r.file]=(o[r.file]||[]).concat(r)}}const i=Object.keys(o).length;if(i===0)return t(i);let l=0;const n=(a,u)=>{if(u&&f.warn("There was an error while preloading an audio file: "+u),l++,l===i)return t(i);e(l,i)},h=(a,u,r)=>{const c=r?this._loadedMusics:this._loadedSounds;c[a]=new Howl(Object.assign({},p,{src:[a],onload:u,onloaderror:u,html5:r,volume:0}))};for(let a in o)if(o.hasOwnProperty(a)){const u=o[a][0];if(!u.preloadAsSound&&!u.preloadAsMusic)n();else if(u.preloadAsSound&&u.preloadAsMusic){let r=!1;const c=(S,m)=>{if(!r){r=!0;return}n(S,m)};h(a,c,!0),h(a,c,!1)}else u.preloadAsSound?h(a,n,!1):u.preloadAsMusic&&h(a,n,!0)}}}_.HowlerSoundManager=g,_.SoundManager=g})(gdjs||(gdjs={}));
//# sourceMappingURL=howler-sound-manager.js.map
